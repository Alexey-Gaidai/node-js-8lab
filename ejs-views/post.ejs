<!DOCTYPE html>
<html lang="en">
<%- include('./partials/head.ejs') %>

    <body>
        <%- include('./partials/nav.ejs') %>
            <article class="post">
                <div class="info">
                    <span><%= post.createdAt.toLocaleDateString() || 'No date' %></span>
                    <span><%= post.author %></span>
                </div>
                <h1>
                    <%= post.title %>
                </h1>
                <p>
                    <%= post.text %>
                </p>
                <a href="/edit/<%= post.id %>" class="btn-edit">
                    <i class="fas fa-edit"></i>
                </a>
                <button class="btn-delete" data-id="<%= post.id %>">
                    <i class="fas fa-trash-alt" data-id="<%= post.id %>"></i>
                </button>
            </article>

            <ul>
                    <% post.review.forEach(({ name, reviewMessage, mark}) => { %>
                        <li>
                            <article>
                                <div class="info">
                                    <span><%= post.createdAt.toLocaleDateString() || 'No date' %></span>
                                    <span><%= name %></span>
                                </div>
                                <h1>
                                    <%= mark %>
                                </h1>
                                <p>
                                    <%= reviewMessage %>
                                </p>
                            </article>
                        </li>
                    <% }) %>
            </ul>

            <form id="post-review" method="post" action="/posts/<%= post.id %>?_method=post">
                <div class="form-info">
                  <label>Имя
                    <input type="text" name="name">
                  </label>
                  <label>Оценка
                    <input type="text" name="mark">
                  </label>
                </div>
                <div class="form-text">
                  <label>Отзыв
                    <textarea name="reviewMessage"></textarea>
                  </label>
                </div>
                <div class="form-button">
                  <input type="submit" value="Оставить отзыв">
                </div>
            </form>

            <script>
                document.addEventListener('click', (e) => {
                    const id = e.target ?.dataset ?.id || null;
                    if (id) {
                        fetch(`/posts/${id}`, {
                            method: 'DELETE',
                        }).then(() => {
                            window.location.href = '/posts';
                        });
                    }
                });
            </script>
    </body>

</html>